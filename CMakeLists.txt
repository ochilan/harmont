cmake_minimum_required(VERSION 2.8.8)
project(harmont)

set (harmont_VERSION_MAJOR 0)
set (harmont_VERSION_MINOR 1)

option(USE_PLUSTACHE "Add support for shader templates (needs plustache library)" True)
option(USE_FREEGLUT "Add support for freeglut application implementation (needs GLUT library)" False)

include_directories("${PROJECT_SOURCE_DIR}")
include_directories("${PROJECT_BINARY_DIR}")
include_directories("${PROJECT_SOURCE_DIR}/include")
set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/modules)

if(CMAKE_COMPILER_IS_GNUCXX)
	add_definitions(-fPIC)
	add_definitions(-O3)
	add_definitions(-g)
	add_definitions(-std=c++1y)
    add_definitions(-Wall)
    add_definitions(-Wno-unused-function)
    if(USE_PLUSTACHE)
        add_definitions(-DUSE_PLUSTACHE)
    endif()
    if(USE_FREEGLUT)
        add_definitions(-DUSE_FREEGLUT)
    endif()
endif()

find_package(Eigen)
find_package(OpenGL)
find_package(GLEW)
if(USE_PLUSTACHE)
    find_package(Plustache)
endif()
if(USE_FREEGLUT)
    find_package(GLUT)
endif()

file (GLOB_RECURSE obj RELATIVE "${PROJECT_SOURCE_DIR}" "src/*.cpp")
file (GLOB_RECURSE units RELATIVE "${PROJECT_SOURCE_DIR}" "test/units/*.cpp")
if (GLEW_FOUND AND EIGEN_FOUND AND (NOT USE_PLUSTACHE OR PLUSTACHE_FOUND) AND (NOT USE_FREEGLUT OR GLUT_FOUND))
	include_directories(${GLEW_INCLUDE_DIRS})
	include_directories(${EIGEN_INCLUDE_DIRS})
    if(USE_PLUSTACHE)
        include_directories(${PLUSTACHE_INCLUDE_DIRS})
    else()
        set(PLUSTACHE_LIBRARIES "")
    endif()
    if(USE_FREEGLUT)
        include_directories(${GLUT_INCLUDE_DIRS})
    else()
        set(GLUT_LIBRARIES "")
    endif()
	add_library(harmont SHARED ${obj})
	target_link_libraries(harmont ${GLUT_LIBRARIES} ${GLEW_LIBRARIES} ${PLUSTACHE_LIBRARIES} "dl")
#	add_definitions(-Dprotected=public)
#	add_definitions(-DTESTING)
#	add_executable(test "test/test.cpp" ${units})
#	target_link_libraries(test harmont ${GLEW_LIBRARIES} "dl" "pthread" "unittest" "damogran")

	# install binary
	install (TARGETS harmont DESTINATION lib)
	# install header
	install (DIRECTORY include/ DESTINATION include/harmont)
endif()

